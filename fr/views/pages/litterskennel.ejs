<div id="kennel" v-cloak>

  <!-- start banner Area -->
  <section class="banner-area relative">
    <div class="container">
      <div class="row d-flex align-items-center justify-content-center">
        <div class="about-content col-lg-12">
          <h1 class="text-white"><%= __('Litters') %></h1>
          <p><%= __('All litter kennel') %></p>
        </div>
      </div>
    </div>
  </section>
  <!-- End banner Area -->

  <!-- Start Work Area Area -->
  <section class="work-area section-gap-top" id="work">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="section-title text-center">
            <h3><%= __('Portfolio') %></h3>
            <h2><span><%= __('Check Our Work') %></span></h2>
            <div class="mt-5">
              <button class="btn btn-outline-info" @click="clickAddButton()"><%= __('Add a photo') %></button>
            </div>
          </div>
        </div>
        <div class="col-lg-12 d-none">
          <div class="filters">
            <ul>
              <li class="active" data-filter=".all"></li>
            </ul>
          </div>
        </div>
      </div>

      <!--<div class="filters-content" v-if="litters.length > 0">
        <div class="row grid">
          <div class="col-lg-4 col-md-6 grid-sizer"></div>
          <div v for="(litter, key, index) in litters" :key="index" class="col-lg-8 grid-item col-md-6 all wow fadeIn"
               data-wow-duration="2s" data-wow-delay="0.4 s">
            <div class="single-work">
              <div class="relative">
                <div class="thumb">
                  <a :href="litter.detail" >
                  <img class="image img-fluid" :src="litter.imageSrc" alt="">
                  </a>
                </div>
                <div class="middle">
                  <ul class="navbar-nav  my-sm-0 ">
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
                         aria-haspopup="true" aria-expanded="false">
                        <i class="ti-settings"></i>
                      </a>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" v-if="litter.owner.id === me.id" href="#"
                           @click="clickDeleteLitter(litter.id)">
                          Delete
                        </a>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        &lt;!&ndash;<a class="dropdown-item" href="#">Somelitter else here</a>&ndash;&gt;
                      </div>
                    </li>
                  </ul>

                  <h3>Litter: {{litter.label | capitalize}}</h3>
                  <div class="cat">Litter born: {{litter.born | date('fr') }}</div>
                  <h4 v-if="litter.owner.id === me.id" class="card-link"><i class="ti-home"></i> Mine</h4>
                  <h5 v-if="litter.owner.id !== me.id"> Owner: <a href="#" class="card-link">{{litter.owner.fullName}}</a></h5>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>-->
      <div class="listings" v-if="litters.length > 0">
        <div class="card" :key="'litter'+litter.id"
             :class="[litter.owner.id === me.id ? 'mine' : '', litter.unavailable ? 'not-available' : '']"
             v-for="(litter, index) in litters"
             :data-index="index"

        >
          <div class="card-options dropdown" v-if="litter.borrowedBy && litter.owner.id === me.id">
            <span class="options-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span
                class="fa fa-ellipsis-v"></span></span>
            <div class="dropdown-menu dropdown-menu-right">
              <span class="dropdown-item" @click="clickDeleteLitter(litter.id)">Delete</span>
              <span class="dropdown-item" @click="clickMarkReturned(litter.id)">Mark as returned</span>
              <span class="dropdown-item" @click="clickContactBorrower(litter.id)">Contact {{litter.borrowedBy.fullName}}</span>
            </div>
          </div>
          <div class="card-options dropdown" v-else-if="litter.borrowedBy && litter.borrowedBy.id === me.id">
            <span class="options-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span
                class="fa fa-ellipsis-v"></span></span>
            <div class="dropdown-menu dropdown-menu-right">
              <span class="dropdown-item" @click="clickReturn(litter.id)"><%= __('Give this back') %></span>
              <span class="dropdown-item" @click="clickContactOwner(litter.id)"><%= __('Contact') %> {{litter.owner.fullName}}</span>
            </div>
          </div>
          <div class="card-options" v-else-if="!litter.borrowedBy">
            <span class="options-button" data-toggle="tooltip" data-placement="top" title="Delete" @click="clickDeleteLitter(litter.id)"
                  v-if="litter.owner.id === me.id"><span class="fa fa-trash-o text-danger"></span></span>
            <span class="options-button borrow" data-toggle="tooltip" data-placement="top" title="Borrow" @click="clickBorrow(litter.id)"
                  v-else><span class="fa fa-handshake-o text-dark"></span></span>
          </div>


            <img alt="A mysterious item" :alt="litter.label ? litter.label : 'A mysterious item'" :src="litter.imageSrc"/>

          <span class="label" v-if="litter.label">{{litter.label}}<br/></span>
          <small class="owner text-secondary" v-if="litter.owner.id === me.id"><span class="fa fa-home mr-1"></span> Mine</small>
          <small class="owner text-success" v-else-if="litter.borrowedBy && litter.borrowedBy.id === me.id"><span
              class="fa fa-star-o mr-1"></span> <%= __('Borrowing') %>
          </small>
          <small class="owner text-primary" v-else>{{litter.owner.fullName}}</small>
        </div>
      </div>
      <div class="empty text-center" v-else><p><%= __('You have not downloaded yet a single idea of your litters.') %> <a
            href="/litters/new" @click="clickAddButton()"><%= __('Add your') %></a> <%= __('first litter show now') %>!</p></div>

    </div>
  </section>
  <!-- End Work Area Area -->


  <% /* "Upload Litter" Modal */ %>
  <modal v-if="virtualPageSlug==='new'" v-cloak key="new" @close="closeUploadLitterModal()">
    <div class="modal-header">
      <h5 class="modal-title"><%= __('Upload new photo') %></h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span>&times;</span>
      </button>
    </div>

    <ajax-form action="uploadLitter" :syncing.sync="syncing" :cloud-error.sync="cloudError"
               :handle-parsing="handleParsingUploadLitterForm"
               @submitted="submittedUploadLitterForm($event)">

      <div class="modal-body">
        <div class="form-group">
          <label><%= __('Add a photo') %>:</label>
          <div class="photo-uploader" :class="!uploadFormData.previewImageSrc ? 'empty' :  ''">
            <div class="photo-upload-field row d-flex align-items-center"
                 :class="!uploadFormData.previewImageSrc ? 'justify-content-center' :  'justify-content-start'">
              <div class="photo-preview col">
                <div class="image-wrapper"
                     :class="!uploadFormData.previewImageSrc ? 'd-flex align-items-center justify-content-center' : ''">

                  <img v-if="uploadFormData.previewImageSrc" alt="A preview of the selected item"
                       :src="uploadFormData.previewImageSrc"/>
                  <span v-else class="placeholder-icon fa fa-picture-o"></span>
                </div>
              </div>
              <div class="col d-flex-column justify-content-center">
                <span class="file-upload-button btn btn-sm"
                      :class="[formErrors.photo ? 'btn-outline-danger' : !uploadFormData.previewImageSrc ? 'btn-outline-success' : 'btn-outline-secondary mr-3']">
                  <span class="button-text" v-if="!uploadFormData.previewImageSrc"><%= __('Select image') %></span>
                  <span class="button-text" v-else><%= __('Change image') %></span>
                  <input type="file" :disabled="syncing" accept="image/*" class="file-input"
                         @change="changeFileInput($event.target.files)"/>
                </span>
                <p class="image-advice text-muted" v-if="!formErrors.photo">
                  <strong><%= __('Tip') %></strong>: <%= __('Make sure the object is in the front and center of the photo so that people understand exactly who you are representing.') %>
                </p>
                <p class="image-advice text-danger" v-if="formErrors.photo">
                  <%= __('A photo is required in order to add a new item') %>.</p>
              </div>
            </div>
          </div>
        </div>
        <!--<div class="form-group"><label>Add a photo:</label>
          <div class="photo-uploader">
            <div class="photo-upload-field row d-flex align-items-center">
              <div class="col d-flex-column justify-content-center">
                &lt;!&ndash;
                :disabled - отключает input для приёма изображений,
                 когда флаг синхронизации (syncing) содержит true
                 Поробное описание в "JOURNAL" SAILS.JS.txt
                &ndash;&gt;
                <input type="file" @change="changeFileInput($event.target.files)"
                       :disabled="syncing" accept="image/*" class="file-input">
                <p class="image-advice text-muted" v-if="!formErrors.photo">
                  <strong>Tip</strong>: Make sure the item is front and center in the photo,
                  so people know exactly what you're offering to share.
                </p>
                <p></p>
                <img :src="uploadFormData.photo" alt="">
                <p class="image-advice text-danger" v-if="formErrors.photo">
                  A photo is required in order to add a new item.
                </p>
              </div>
            </div>
          </div>
        </div>-->
        <div class="form-group">
          <label><%= __('When were born?') %></label>
          <!--<input class="form-control" type="date" v-model="uploadFormData.born">-->
          <datepicker ref="datepickerref" v-model="uploadFormData.born" placeholder-text="(<%= __('Date of litter') %>)" :popup="true"
                      :invalid="formErrors.born"
                      validation-error-message="<%= __('Please set the date when puppies were born.') %>."></datepicker>
        </div>
        <div class="form-group">
          <label><%= __('Litter letter') %></label>
          <input class="form-control" :class="formErrors.label ? 'is-invalid' : ''"
                  type="text" id="validationServerUsername"
                 aria-describedby="inputGroupPrepend3"
                 v-model="uploadFormData.label" placeholder="A" >
          <small v-if="formErrors.label" class="text-danger "><%= __('Please indicate the litter letter.') %></small>
        </div>
        <div class="form-group">
          <label><%= __('Title') %></label>
          <input class="form-control" type="text" v-model="uploadFormData.title">
        </div>
        <div class="form-group">
          <label><%= __('Sub Title') %></label>
          <input class="form-control" type="text" v-model="uploadFormData.subtitle">
        </div>

        <p class="text-danger" v-if="cloudError === 'tooBig'">
          <small><%= __('That file is too big. Please choose a junkier picture') %>.</small>
        </p>
        <p class="text-danger" v-else-if="cloudError">
          <small><%= __('An error occured while processing your request. Please check your information and try again, or') %> <a
              href="/support"><%= __('contact support') %></a> <%= __('if the error persists') %>.
          </small>
        </p>

      </div>

      <div class="modal-footer flex-row-reverse justify-content-start">
        <ajax-button type="submit" :syncing="syncing" class="btn btn-primary ml-1"><%= __('Save') %></ajax-button>
        <button data-dismiss="modal" class="btn btn-outline-primary mr-1"><%= __('Cancel') %></button>
      </div>
    </ajax-form>
  </modal>

  <% /* "Borrow litter" modal */ %>
  <modal v-if="borrowLitterModalOpen && selectedLitter" v-cloak key="borrow" @close="closeBorrowLitterModal()">
    <div class="modal-header">
      <h5 class="modal-title">Borrow this {{selectedLitter.label || 'item'}}</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span>&times;</span>
      </button>
    </div>
    <ajax-form action="borrowLitter" :syncing.sync="syncing" :cloud-error.sync="cloudError" :handle-parsing="handleParsingBorrowLitterForm" @submitted="submittedBorrowLitterForm($event)" v-if="!borrowFormSuccess">
      <div class="modal-body">
        <div class="item-preview d-flex justify-content-center">
          <div class="card">
            <img alt="A mysterious item" :alt="selectedLitter.label ? selectedLitter.label : 'A mysterious item'" :src="selectedLitter.imageSrc"/>
          </div>
        </div>
        <div class="form-group mt-4">
          <label>How long do you want to borrow it?</label>
          <div class="field-wrap">
            <span class="datepicker-label">Until</span>
            <datepicker ref="datepickerref" v-model="borrowFormData.born" placeholder-text="(Choose return date)" :popup="true" :invalid="formErrors.born" validation-error-message="Please let the owner know when you can return the item."></datepicker>
          </div>
        </div>
        <div class="form-group mt-4">
          <label>When can you pick it up?</label>
          <input class="form-control" type="text" placeholder="e.g. This afternoon or anytime tomorrow" v-model="borrowFormData.pickupInfo" :class="[formErrors.pickupInfo ? 'is-invalid' : '']">
          <div class="invalid-feedback" v-if="formErrors.pickupInfo">Please add your pickup availability.</div>
        </div>
        <p class="text-danger" v-if="cloudError"><small>An error occurred while processing your request. Please check your information and try again, or <a href="/support">contact support</a> if the error persists.</small></p>
      </div>
      <div class="modal-footer  flex-row-reverse justify-content-start">
        <ajax-button type="submit" :syncing="syncing" class="btn btn-primary ml-1">Borrow</ajax-button>
        <button data-dismiss="modal" class="btn btn-outline-primary mr-1">Cancel</button>
      </div>
    </ajax-form>
    <div class="modal-body" v-else>
      <p>We let the owner of <strong class="text-success">{{selectedLitter.label || 'item'}}</strong> know when you could drop by.</p>
      <p>Stay in touch with {{selectedLitter.owner.fullName}} to confirm pickup details: <strong>{{selectedLitter.owner.emailAddress}}</strong></p>
    </div>
    <div class="modal-footer" v-if="borrowFormSuccess">
      <button data-dismiss="modal" class="btn btn-outline-success">Got it</button>
    </div>
  </modal>

  <% /* "Confirm Delete Litter" Modal */ %>
  <modal v-if="confirmDeleteLitterModalOpen && selectedLitter" v-cloak key="delete"
         @close="closeDeleteLitterModal()">
    <div class="modal-header">
      <h5 class="modal-title">Remove this item?</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span>&times;</span>
      </button>
    </div>
    <ajax form action="destroyOneLitter" :syncing.sync="syncing" :cloud-error.sync="cloudError"
               :handle-parsing="handleParsingDeleteLitterForm"
               @submitted="submittedDeleteLitterForm()">
      <div class="modal-body">
        <p>Are you sure you want to remove this {{selectedLitter.label || 'item'}}?</p>
        <p class="text-muted" v-if="selectedLitter.borrowedBy">We will no longer be able to assist with the return of this item, so you will
          need to contact {{selectedLitter.borrowedBy.fullName}} directly to coordinate.</p>
        <p v-else>This item will no longer be available to share with friends.</p>
        <p class="text-danger" v-if="cloudError">
          <small>An error occured while processing your request. Please check your information and try again, or <a href="/contact">contact
              support</a> if the error persists.
          </small>
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary mr-1" data-dismiss="modal">Nevermind</button>
        <button type="submit" class="btn btn-danger ml-1">Remove</button>
      </div>
    </ajax-form>
  </modal>

  <% /* For virtual pages */ %>
  <router-view></router-view>
</div>
<%- /* Exposez server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
